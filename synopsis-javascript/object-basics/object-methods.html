<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial=scale=1.0">

  <title>Методы объекта, "this"</title>
  
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/fonts.css">
  <link rel="shortcut icon" href="../img/iconfinder_graduation_cap.png">
</head>

<body>
  <div class="page-wrapper">
    <div class="page">
      <div class="main__header">
        <div class="main__header-group">
          <ol class="breadcrumbs">
            <li class="breadcrumbs__item breadcrumbs__item_home">
              <a class="breadcrumbs__link" title="Оглавление" href="../index.html"></a>
            </li>
            <li class="breadcrumbs__item"></li>
          </ol>
          <div class="updated-at">
            <div class="updated-at__content">3-го августа 2020</div>
          </div>
        </div>
        <h1 class="page__title">Методы объекта, "this"</h1>
      </div>
      <div itemprop="articleBody">
        <p>Объекты обычно создаются, чтобы представлять сущности реального мира, будь то пользователи, заказы и так далее:</p>
        <div class="code-example">
          <div class="codebox">
            <div class="line-numbers language-javascript">
              <code class="language-javascript">
<pre>
<code class="token comment">// Объект пользователя</code>
<code class="token keyword">let</code> user <code class="token operator">=</code> <code class="token punctuation">{</code>
  name<code class="token punctuation">:</code> <code class="token string">"Джон"</code><code class="token punctuation">,</code>
  age<code class="token punctuation">:</code> <code class="token number">30</code>
<code class="token punctuation">}</code><code class="token punctuation">;</code>
</pre>
              </code>
              <span class="line-numbers-rows">
                <script src="../js/line-numbers-rows.js"></script>
                <script>rowsNumbers(5);</script>
              </span>
            </div>
          </div>
        </div>
        <p>И так же, как и в реальном мире, пользователь может <em>совершать действия</em>: выбирать что-то из корзины покупок, авторизовываться, выходить из системы, оплачивать и т.п.</p>
        <p>Такие действия в JavaScript представлены свойствами-функциями объекта.</p>
        <h2>Примеры методов</h2>
        <p>Для начала давайте научим нашего пользователя <code>user</code> здороваться:</p>
        <div class="code-example">
          <div class="codebox">
            <div class="line-numbers language-javascript">
              <code class="language-javascript">
<pre>
<code class="token keyword">let</code> user <code class="token operator">=</code> <code class="token punctuation">{</code>
  name<code class="token punctuation">:</code> <code class="token string">"Джон"</code><code class="token punctuation">,</code>
  age<code class="token punctuation">:</code> <code class="token number">30</code>
<code class="token punctuation">}</code><code class="token punctuation">;</code>

user<code class="token punctuation">.</code><code class="token function-variable function">sayHi</code> <code class="token operator">=</code> <code class="token keyword">function</code><code class="token punctuation">(</code><code class="token punctuation">)</code> <code class="token punctuation">{</code>
  <code class="token function">alert</code><code class="token punctuation">(</code><code class="token string">"Привет!"</code><code class="token punctuation">)</code><code class="token punctuation">;</code>
<code class="token punctuation">}</code><code class="token punctuation">;</code>

user<code class="token punctuation">.</code><code class="token function">sayHi</code><code class="token punctuation">(</code><code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token comment">// Привет!</code>
</pre>
              </code>
              <span class="line-numbers-rows">
                <script src="../js/line-numbers-rows.js"></script>
                <script>rowsNumbers(10);</script>
              </span>
            </div>
          </div>
        </div>
        <p>Здесь мы просто использовали Function Exdivssion (функциональное выражение), чтобы создать функцию для приветствия, и присвоили её свойству <code>user.sayHi</code> нашего объекта.</p>
        <p>Затем мы вызвали её. Теперь пользователь может говорить!</p>
        <p>Функцию, которая является свойством объекта, называют <em>методом</em> этого объекта.</p>
        <p>Итак, мы получили метод <code>sayHi</code> объекта <code>user</code>.</p>
        <p>Конечно, мы могли бы заранее объявить функцию и использовать её в качестве метода, примерно так:</p>
        <div class="code-example">
          <div class="codebox">
            <div class="line-numbers language-javascript">
              <code class="language-javascript">
<pre>
<code class="token keyword">let</code> user <code class="token operator">=</code> <code class="token punctuation">{</code>
  <code class="token comment">// ...</code>
<code class="token punctuation">}</code><code class="token punctuation">;</code>

<code class="token comment">// сначала объявляем</code>
<code class="token keyword">function</code> <code class="token function">sayHi</code><code class="token punctuation">(</code><code class="token punctuation">)</code> <code class="token punctuation">{</code>
  <code class="token function">alert</code><code class="token punctuation">(</code><code class="token string">"Привет!"</code><code class="token punctuation">)</code><code class="token punctuation">;</code>
<code class="token punctuation">}</code><code class="token punctuation">;</code>

<code class="token comment">// затем добавляем в качестве метода</code>
user<code class="token punctuation">.</code>sayHi <code class="token operator">=</code> sayHi<code class="token punctuation">;</code>

user<code class="token punctuation">.</code><code class="token function">sayHi</code><code class="token punctuation">(</code><code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token comment">// Привет!</code>
</pre>
              </code>
              <span class="line-numbers-rows">
                <script src="../js/line-numbers-rows.js"></script>
                <script>rowsNumbers(13);</script>
              </span>
            </div>
          </div>
        </div>
        <div class="important important_smart">
          <div class="important__header"><span class="important__type">Объектно-ориентированное программирование</span></div>
          <div class="important__content"><p>Когда мы пишем наш код, используя объекты для представления сущностей реального мира, – это называется <a href="https://ru.wikipedia.org/wiki/%D0%9E%D0%B1%D1%8A%D0%B5%D0%BA%D1%82%D0%BD%D0%BE-%D0%BE%D1%80%D0%B8%D0%B5%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D0%BE%D0%B5_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">объектно-ориентированное программирование</a> или сокращённо: «ООП».</p>
            <p>ООП является большой предметной областью и интересной наукой само по себе. Как выбрать правильные сущности? Как организовать взаимодействие между ними? Это – создание архитектуры, и есть хорошие книги по этой теме, такие как «Приёмы объектно-ориентированного проектирования. Паттерны проектирования» авторов Эрих Гамма, Ричард Хелм, Ральф Джонсон, Джон Влиссидес или «Объектно-ориентированный анализ и проектирование с примерами приложений» Гради Буча, а также ещё множество других книг.</p>
          </div>
        </div>
        <h3>Сокращённая запись метода</h3>
        <p>Существует более короткий синтаксис для методов в литерале объекта:</p>
        <div class="code-example">
          <div class="codebox">
            <div class="line-numbers language-javascript">
              <code class="language-javascript">
<pre>
<code class="token comment">// эти объекты делают одно и то же (одинаковые методы)</code>

user <code class="token operator">=</code> <code class="token punctuation">{</code>
  <code class="token function-variable function">sayHi</code><code class="token punctuation">:</code> <code class="token keyword">function</code><code class="token punctuation">(</code><code class="token punctuation">)</code> <code class="token punctuation">{</code>
    <code class="token function">alert</code><code class="token punctuation">(</code><code class="token string">"Привет"</code><code class="token punctuation">)</code><code class="token punctuation">;</code>
  <code class="token punctuation">}</code>
<code class="token punctuation">}</code><code class="token punctuation">;</code>

<code class="token comment">// сокращённая запись выглядит лучше, не так ли?</code>
user <code class="token operator">=</code> <code class="token punctuation">{</code>
  <code class="token function">sayHi</code><code class="token punctuation">(</code><code class="token punctuation">)</code> <code class="token punctuation">{</code> <code class="token comment">// то же самое, что и "sayHi: function()"</code>
    <code class="token function">alert</code><code class="token punctuation">(</code><code class="token string">"Привет"</code><code class="token punctuation">)</code><code class="token punctuation">;</code>
  <code class="token punctuation">}</code>
<code class="token punctuation">}</code><code class="token punctuation">;</code>
</pre>
              </code>
              <span class="line-numbers-rows">
                <script src="../js/line-numbers-rows.js"></script>
                <script>rowsNumbers(14);</script>
              </span>
            </div>
          </div>
        </div>
        <p>Как было показано, мы можем пропустить ключевое слово <code>"function"</code> и просто написать <code>sayHi()</code>.</p>
        <p>Нужно отметить, что эти две записи не полностью эквивалентны. Есть тонкие различия, связанные с наследованием объектов (что будет рассмотрено позже), но на данном этапе изучения это неважно. В большинстве случаев сокращённый синтаксис предпочтителен.</p>
        <h2>Ключевое слово «this» в методах</h2>
        <p>Как правило, методу объекта необходим доступ к информации, которая хранится в объекте, чтобы выполнить с ней какие-либо действия (в соответствии с назначением метода).</p>
        <p>Например, коду внутри <code>user.sayHi()</code> может понадобиться имя пользователя, которое хранится в объекте <code>user</code>.</p>
        <p><strong>Для доступа к информации внутри объекта метод может использовать ключевое слово <code>this</code>.</strong></p>
        <p>Значение <code>this</code> – это объект «перед точкой», который использовался для вызова метода.</p>
        <p>Например:</p>
        <div class="code-example">
          <div class="codebox">
            <div class="line-numbers language-javascript">
              <code class="language-javascript">
<pre>
<code class="token keyword">let</code> user <code class="token operator">=</code> <code class="token punctuation">{</code>
  name<code class="token punctuation">:</code> <code class="token string">"Джон"</code><code class="token punctuation">,</code>
  age<code class="token punctuation">:</code> <code class="token number">30</code><code class="token punctuation">,</code>

  <code class="token function">sayHi</code><code class="token punctuation">(</code><code class="token punctuation">)</code> <code class="token punctuation">{</code>
    <code class="token comment">// this - это "текущий объект"</code>
    <code class="token function">alert</code><code class="token punctuation">(</code><code class="token keyword">this</code><code class="token punctuation">.</code>name<code class="token punctuation">)</code><code class="token punctuation">;</code>
  <code class="token punctuation">}</code>

<code class="token punctuation">}</code><code class="token punctuation">;</code>

user<code class="token punctuation">.</code><code class="token function">sayHi</code><code class="token punctuation">(</code><code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token comment">// Джон</code>
</pre>
              </code>
              <span class="line-numbers-rows">
                <script src="../js/line-numbers-rows.js"></script>
                <script>rowsNumbers(12);</script>
              </span>
            </div>
          </div>
        </div>
        <p>Здесь во время выполнения кода <code>user.sayHi()</code> значением <code>this</code> будет являться <code>user</code> (ссылка на объект <code>user</code>).</p>
        <p>Технически также возможно получить доступ к объекту без ключевого слова <code>this</code>, ссылаясь на него через внешнюю переменную (в которой хранится ссылка на этот объект):</p>
        <div class="code-example">
          <div class="codebox">
            <div class="line-numbers language-javascript">
              <code class="language-javascript">
<pre>
<code class="token keyword">let</code> user <code class="token operator">=</code> <code class="token punctuation">{</code>
  name<code class="token punctuation">:</code> <code class="token string">"Джон"</code><code class="token punctuation">,</code>
  age<code class="token punctuation">:</code> <code class="token number">30</code><code class="token punctuation">,</code>

  <code class="token function">sayHi</code><code class="token punctuation">(</code><code class="token punctuation">)</code> <code class="token punctuation">{</code>
    <code class="token function">alert</code><code class="token punctuation">(</code>user<code class="token punctuation">.</code>name<code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token comment">// используем переменную "user" вместо ключевого слова "this"</code>
  <code class="token punctuation">}</code>

<code class="token punctuation">}</code><code class="token punctuation">;</code>
</pre>
              </code>
              <span class="line-numbers-rows">
                <script src="../js/line-numbers-rows.js"></script>
                <script>rowsNumbers(9);</script>
              </span>
            </div>
          </div>
        </div>
        <p>…Но такой код будет ненадёжным. Если мы решим скопировать ссылку на объект <code>user</code> в другую переменную, например, <code>admin = user</code>, и перезапишем переменную <code>user</code> чем-то другим, тогда будет осуществлён доступ к неправильному объекту при вызове метода из <code>admin</code>.</p>
        <p>Это показано ниже:</p>
        <div class="code-example">
          <div class="codebox">
            <div class="line-numbers language-javascript">
              <code class="language-javascript">
<pre>
<code class="token keyword">let</code> user <code class="token operator">=</code> <code class="token punctuation">{</code>
  name<code class="token punctuation">:</code> <code class="token string">"Джон"</code><code class="token punctuation">,</code>
  age<code class="token punctuation">:</code> <code class="token number">30</code><code class="token punctuation">,</code>

  <code class="token function">sayHi</code><code class="token punctuation">(</code><code class="token punctuation">)</code> <code class="token punctuation">{</code>
    <code class="token function">alert</code><code class="token punctuation">(</code> user<code class="token punctuation">.</code>name <code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token comment">// приведёт к ошибке</code>
  <code class="token punctuation">}</code>

<code class="token punctuation">}</code><code class="token punctuation">;</code>


<code class="token keyword">let</code> admin <code class="token operator">=</code> user<code class="token punctuation">;</code>
user <code class="token operator">=</code> <code class="token keyword">null</code><code class="token punctuation">;</code> <code class="token comment">// обнулим переменную для наглядности, теперь она не хранит ссылку на объект.</code>

admin<code class="token punctuation">.</code><code class="token function">sayHi</code><code class="token punctuation">(</code><code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token comment">// Ошибка! Внутри sayHi() используется user, которая больше не ссылается на объект!</code>
</pre>
              </code>
              <span class="line-numbers-rows">
                <script src="../js/line-numbers-rows.js"></script>
                <script>rowsNumbers(15);</script>
              </span>
            </div>
          </div>
        </div>
        <p>Если мы используем <code>this.name</code> вместо <code>user.name</code> внутри <code>alert</code>, тогда этот код будет работать.</p>
        <h2>«this» не является фиксированным</h2>
        <p>В JavaScript ключевое слово «this» ведёт себя иначе, чем в большинстве других языков программирования. Оно может использоваться в любой функции.</p>
        <p>В этом коде нет синтаксической ошибки:</p>
        <div class="code-example">
          <div class="codebox">
            <div class="line-numbers language-javascript">
              <code class="language-javascript">
<pre>
<code class="token keyword">function</code> <code class="token function">sayHi</code><code class="token punctuation">(</code><code class="token punctuation">)</code> <code class="token punctuation">{</code>
  <code class="token function">alert</code><code class="token punctuation">(</code> <code class="token keyword">this</code><code class="token punctuation">.</code>name <code class="token punctuation">)</code><code class="token punctuation">;</code>
<code class="token punctuation">}</code>
</pre>
              </code>
              <span class="line-numbers-rows">
                <script src="../js/line-numbers-rows.js"></script>
                <script>rowsNumbers(3);</script>
              </span>
            </div>
          </div>
        </div>
        <p>Значение <code>this</code> вычисляется во время выполнения кода и зависит от контекста.</p>
        <p>Например, здесь одна и та же функция назначена двум разным объектам и имеет различное значение «this» при вызовах:</p>
        <div class="code-example">
          <div class="codebox">
            <div class="line-numbers language-javascript">
              <code class="language-javascript">
<pre>
<code class="token keyword">let</code> user <code class="token operator">=</code> <code class="token punctuation">{</code> name<code class="token punctuation">:</code> <code class="token string">"Джон"</code> <code class="token punctuation">}</code><code class="token punctuation">;</code>
<code class="token keyword">let</code> admin <code class="token operator">=</code> <code class="token punctuation">{</code> name<code class="token punctuation">:</code> <code class="token string">"Админ"</code> <code class="token punctuation">}</code><code class="token punctuation">;</code>

<code class="token keyword">function</code> <code class="token function">sayHi</code><code class="token punctuation">(</code><code class="token punctuation">)</code> <code class="token punctuation">{</code>
  <code class="token function">alert</code><code class="token punctuation">(</code> <code class="token keyword">this</code><code class="token punctuation">.</code>name <code class="token punctuation">)</code><code class="token punctuation">;</code>
<code class="token punctuation">}</code>

<code class="token comment">// используем одну и ту же функцию в двух объектах</code>
user<code class="token punctuation">.</code>f <code class="token operator">=</code> sayHi<code class="token punctuation">;</code>
admin<code class="token punctuation">.</code>f <code class="token operator">=</code> sayHi<code class="token punctuation">;</code>

<code class="token comment">// вызовы функции, приведённые ниже, имеют разное значение this</code>
<code class="token comment">// "this" внутри функции является ссылкой на объект, который указан "перед точкой"</code>
user<code class="token punctuation">.</code><code class="token function">f</code><code class="token punctuation">(</code><code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token comment">// Джон  (this == user)</code>
admin<code class="token punctuation">.</code><code class="token function">f</code><code class="token punctuation">(</code><code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token comment">// Админ  (this == admin)</code>

admin<code class="token punctuation">[</code><code class="token string">'f'</code><code class="token punctuation">]</code><code class="token punctuation">(</code><code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token comment">// Админ (неважен способ доступа к методу - через точку или квадратные скобки)</code>
</pre>
              </code>
              <span class="line-numbers-rows">
                <script src="../js/line-numbers-rows.js"></script>
                <script>rowsNumbers(17);</script>
              </span>
            </div>
          </div>
        </div>
        <p>Правило простое: при вызове <code>obj.f()</code> значение <code>this</code> внутри <code>f</code> равно <code>obj</code>. Так что, в приведённом примере это <code>user</code> или <code>admin</code>.</p>
        <div class="important important_smart">
          <div class="important__header"><span class="important__type">Вызов без объекта: <code>this == undefined</code></span></div>
          <div class="important__content">
            <p>Мы даже можем вызвать функцию вовсе без использования объекта:</p>
            <div class="code-example">
              <div class="codebox">
                <div class="line-numbers language-javascript">
                  <code class="language-javascript">
<pre>
<code class="token keyword">function</code> <code class="token function">sayHi</code><code class="token punctuation">(</code><code class="token punctuation">)</code> <code class="token punctuation">{</code>
  <code class="token function">alert</code><code class="token punctuation">(</code><code class="token keyword">this</code><code class="token punctuation">)</code><code class="token punctuation">;</code>
<code class="token punctuation">}</code>

<code class="token function">sayHi</code><code class="token punctuation">(</code><code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token comment">// undefined</code>
</pre>
                  </code>
                  <span class="line-numbers-rows">
                    <script src="../js/line-numbers-rows.js"></script>
                    <script>rowsNumbers(5);</script>
                  </span>
                </div>
              </div>
            </div>
            <p>В строгом режиме (<code>"use strict"</code>) в таком коде значением <code>this</code> будет являться <code>undefined</code>. Если мы попытаемся получить доступ к <code>name</code>, используя <code>this.name</code> – это вызовет ошибку.</p>
            <p>В нестрогом режиме значением <code>this</code> в таком случае будет <em>глобальный объект</em> (<code>window</code> для браузера, мы вернёмся к этому позже в главе  <a href="/global-object">Глобальный объект</a>). Это – исторически сложившееся поведение <code>this</code>, которое исправляется использованием строгого режима (<code>"use strict"</code>).</p>
            <p>Обычно подобный вызов является ошибкой программирования. Если внутри функции используется <code>this</code>, тогда ожидается, что она будет вызываться в контексте какого-либо объекта.</p>
          </div>
        </div>
        <div class="important important_smart">
          <div class="important__header"><span class="important__type">Последствия свободного <code>this</code></span></div>
          <div class="important__content"><p>Если вы до этого изучали другие языки программирования, тогда вы, скорее всего, привыкли к идее "фиксированного <code>this</code>" – когда методы, определённые внутри объекта, всегда сохраняют в качестве значения <code>this</code> ссылку на свой объект (в котором был определён метод).</p>
            <p>В JavaScript <code>this</code> является «свободным», его значение вычисляется в момент вызова метода и не зависит от того, где этот метод был объявлен, а зависит от того, какой объект вызывает метод (какой объект стоит «перед точкой»).</p>
            <p>Эта идея вычисления <code>this</code> в момент исполнения имеет как свои плюсы, так и минусы. С одной стороны, функция может быть повторно использована в качестве метода у различных объектов (что повышает гибкость). С другой стороны, большая гибкость увеличивает вероятность ошибок.</p>
            <p>Здесь мы не будем судить о том, является ли это решение в языке хорошим или плохим. Мы должны понимать, как с этим работать, чтобы получать выгоды и избегать проблем.</p>
          </div>
        </div>
        <h2>Внутренняя реализация: Ссылочный тип</h2>
        <div class="important important_warn">
          <div class="important__header"><span class="important__type">Продвинутая возможность языка</span></div>
          <div class="important__content"><p>Этот раздел объясняет сложную тему, чтобы лучше понимать некоторые запутанные случаи.</p>
            <p>Если вы хотите продвигаться быстрее, его можно пропустить или отложить.</p>
          </div>
        </div>
        <p>Некоторые хитрые способы вызова метода приводят к потере значения <code>this</code>, например:</p>
        <div class="code-example">
          <div class="codebox">
            <div class="line-numbers language-javascript">
              <code class="language-javascript">
<pre>
<code class="token keyword">let</code> user <code class="token operator">=</code> <code class="token punctuation">{</code>
  name<code class="token punctuation">:</code> <code class="token string">"Джон"</code><code class="token punctuation">,</code>
  <code class="token function">hi</code><code class="token punctuation">(</code><code class="token punctuation">)</code> <code class="token punctuation">{</code> <code class="token function">alert</code><code class="token punctuation">(</code><code class="token keyword">this</code><code class="token punctuation">.</code>name<code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token punctuation">}</code><code class="token punctuation">,</code>
  <code class="token function">bye</code><code class="token punctuation">(</code><code class="token punctuation">)</code> <code class="token punctuation">{</code> <code class="token function">alert</code><code class="token punctuation">(</code><code class="token string">"Пока"</code><code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token punctuation">}</code>
<code class="token punctuation">}</code><code class="token punctuation">;</code>

user<code class="token punctuation">.</code><code class="token function">hi</code><code class="token punctuation">(</code><code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token comment">// Джон (простой вызов метода работает хорошо)</code>

<code class="token comment">// теперь давайте попробуем вызывать user.hi или user.bye</code>
<code class="token comment">// в зависимости от имени пользователя user.name</code>
<code class="token punctuation">(</code>user<code class="token punctuation">.</code>name <code class="token operator">==</code> <code class="token string">"Джон"</code> <code class="token operator">?</code> user<code class="token punctuation">.</code>hi <code class="token punctuation">:</code> user<code class="token punctuation">.</code>bye<code class="token punctuation">)</code><code class="token punctuation">(</code><code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token comment">// Ошибка!</code>
</pre>
              </code>
              <span class="line-numbers-rows">
                <script src="../js/line-numbers-rows.js"></script>
                <script>rowsNumbers(11);</script>
              </span>
            </div>
          </div>
        </div>
        <p>В последней строчке кода используется условный оператор <code>?</code>, который определяет, какой будет вызван метод (<code>user.hi</code> или <code>user.bye</code>) в зависимости от выполнения условия. В данном случае будет выбран <code>user.hi</code>.</p>
        <p>Затем метод тут же вызывается с помощью скобок <code>()</code>. Но вызов не работает как положено!</p>
        <p>Вы можете видеть, что при вызове будет ошибка, потому что значением <code>"this"</code> внутри функции становится <code>undefined</code> (полагаем, что у нас строгий режим).</p>
        <p>Так работает (доступ к методу объекта через точку):</p>
        <div class="code-example">
          <div class="codebox">
            <div class="line-numbers language-javascript">
              <code class="language-javascript">
<pre>
user<code class="token punctuation">.</code><code class="token function">hi</code><code class="token punctuation">(</code><code class="token punctuation">)</code><code class="token punctuation">;</code>
</pre>
              </code>
              <span class="line-numbers-rows">
                <script src="../js/line-numbers-rows.js"></script>
                <script>rowsNumbers(1);</script>
              </span>
            </div>
          </div>
        </div>
        <p>Так уже не работает (вызываемый метод вычисляется):</p>
        <div class="code-example">
          <div class="codebox">
            <div class="line-numbers language-javascript">
              <code class="language-javascript">
<pre>
<code class="token punctuation">(</code>user<code class="token punctuation">.</code>name <code class="token operator">==</code> <code class="token string">"Джон"</code> <code class="token operator">?</code> user<code class="token punctuation">.</code>hi <code class="token punctuation">:</code> user<code class="token punctuation">.</code>bye<code class="token punctuation">)</code><code class="token punctuation">(</code><code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token comment">// Ошибка!</code>
</pre>
              </code>
              <span class="line-numbers-rows">
                <script src="../js/line-numbers-rows.js"></script>
                <script>rowsNumbers(1);</script>
              </span>
            </div>
          </div>
        </div>
        <p>Почему? Если мы хотим понять, почему так происходит, давайте разберёмся (заглянем под капот), как работает вызов методов (<code>obj.method()</code>).</p>
        <p>Присмотревшись поближе, в выражении <code>obj.method()</code> можно заметить две операции:</p>
        <ol>
          <li>Сначала оператор точка <code>'.'</code> возвращает свойство объекта – его метод (<code>obj.method</code>).</li>
          <li>Затем скобки <code>()</code> вызывают этот метод (исполняется код метода).</li>
        </ol>
        <p>Итак, каким же образом информация о <code>this</code> передаётся из первой части во вторую?</p>
        <p>Если мы поместим эти операции в отдельные строки, то значение <code>this</code>, естественно, будет потеряно:</p>
        <div class="code-example">
          <div class="codebox">
            <div class="line-numbers language-javascript">
              <code class="language-javascript">
<pre>
<code class="token keyword">let</code> user <code class="token operator">=</code> <code class="token punctuation">{</code>
  name<code class="token punctuation">:</code> <code class="token string">"Джон"</code><code class="token punctuation">,</code>
  <code class="token function">hi</code><code class="token punctuation">(</code><code class="token punctuation">)</code> <code class="token punctuation">{</code> <code class="token function">alert</code><code class="token punctuation">(</code><code class="token keyword">this</code><code class="token punctuation">.</code>name<code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token punctuation">}</code>
<code class="token punctuation">}</code>

<code class="token comment">// разделим получение метода объекта и его вызов в разных строках</code>
<code class="token keyword">let</code> hi <code class="token operator">=</code> user<code class="token punctuation">.</code>hi<code class="token punctuation">;</code>
<code class="token function">hi</code><code class="token punctuation">(</code><code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token comment">// Ошибка, потому что значением this является undefined</code>
</pre>
              </code>
              <span class="line-numbers-rows">
                <script src="../js/line-numbers-rows.js"></script>
                <script>rowsNumbers(8);</script>
              </span>
            </div>
          </div>
        </div>
        <p>Здесь <code>hi = user.hi</code> сохраняет функцию в переменной, и далее в последней строке она вызывается полностью сама по себе, без объекта, так что нет <code>this</code>.</p>
        <p><strong>Для работы вызовов типа <code>user.hi()</code>, JavaScript использует трюк – точка <code>'.'</code> возвращает не саму функцию, а специальное значение «ссылочного типа», называемого <a href="https://tc39.github.io/ecma262/#sec-reference-specification-type">Reference Type</a>.</strong></p>
        <p>Этот ссылочный тип (Reference Type) является внутренним типом. Мы не можем явно использовать его, но он используется внутри языка.</p>
        <p>Значение ссылочного типа – это «триплет»: комбинация из трёх значений <code>(base, name, strict)</code>, где:</p>
        <ul>
          <li><code>base</code> – это объект.</li>
          <li><code>name</code> – это имя свойства объекта.</li>
          <li><code>strict</code> – это режим исполнения. Является true, если действует строгий режим (<code>use strict</code>).</li>
        </ul>
        <p>Результатом доступа к свойству <code>user.hi</code> является не функция, а значение ссылочного типа. Для <code>user.hi</code> в строгом режиме оно будет таким:</p>
        <div class="code-example">
          <div class="codebox">
            <div class="line-numbers language-javascript">
              <code class="language-javascript">
<pre>
<code class="token comment">// значение ссылочного типа (Reference Type)</code>
<code class="token punctuation">(</code>user<code class="token punctuation">,</code> <code class="token string">"hi"</code><code class="token punctuation">,</code> <code class="token boolean">true</code><code class="token punctuation">)</code>
</pre>
              </code>
              <span class="line-numbers-rows">
                <script src="../js/line-numbers-rows.js"></script>
                <script>rowsNumbers(2);</script>
              </span>
            </div>
          </div>
        </div>
        <p>Когда скобки <code>()</code> применяются к значению ссылочного типа (происходит вызов), то они получают полную информацию об объекте и его методе, и могут поставить правильный <code>this</code> (<code>=user</code> в данном случае, по <code>base</code>).</p>
        <p>Ссылочный тип – исключительно внутренний, промежуточный, используемый, чтобы передать информацию от точки <code>.</code> до вызывающих скобок <code>()</code>.</p>
        <p>При любой другой операции, например, присваивании <code>hi = user.hi</code>, ссылочный тип заменяется на собственно значение <code>user.hi</code> (функцию), и дальше работа уже идёт только с ней. Поэтому дальнейший вызов происходит уже без <code>this</code>.</p>
        <p>Таким образом, значение <code>this</code> передаётся правильно, только если функция вызывается напрямую с использованием синтаксиса точки <code>obj.method()</code> или квадратных скобок <code>obj['method']()</code> (они делают то же самое). Позднее в этом учебнике мы изучим различные варианты решения проблемы потери значения <code>this</code>. Например, такие как <a href="/bind#solution-2-bind">func.bind()</a>.</p>
        <h2>У стрелочных функций нет «this»</h2>
        <p>Стрелочные функции особенные: у них нет своего «собственного» <code>this</code>. Если мы используем <code>this</code> внутри стрелочной функции, то его значение берётся из внешней «нормальной» функции.</p>
        <p>Например, здесь <code>arrow()</code> использует значение <code>this</code> из внешнего метода <code>user.sayHi()</code>:</p>
        <div class="code-example">
          <div class="codebox">
            <div class="line-numbers language-javascript">
              <code class="language-javascript">
<pre>
<code class="token keyword">let</code> user <code class="token operator">=</code> <code class="token punctuation">{</code>
  firstName<code class="token punctuation">:</code> <code class="token string">"Илья"</code><code class="token punctuation">,</code>
  <code class="token function">sayHi</code><code class="token punctuation">(</code><code class="token punctuation">)</code> <code class="token punctuation">{</code>
    <code class="token keyword">let</code> <code class="token function-variable function">arrow</code> <code class="token operator">=</code> <code class="token punctuation">(</code><code class="token punctuation">)</code> <code class="token operator">=&gt;</code> <code class="token function">alert</code><code class="token punctuation">(</code><code class="token keyword">this</code><code class="token punctuation">.</code>firstName<code class="token punctuation">)</code><code class="token punctuation">;</code>
    <code class="token function">arrow</code><code class="token punctuation">(</code><code class="token punctuation">)</code><code class="token punctuation">;</code>
  <code class="token punctuation">}</code>
<code class="token punctuation">}</code><code class="token punctuation">;</code>

user<code class="token punctuation">.</code><code class="token function">sayHi</code><code class="token punctuation">(</code><code class="token punctuation">)</code><code class="token punctuation">;</code> <code class="token comment">// Илья</code>
</pre>
              </code>
              <span class="line-numbers-rows">
                <script src="../js/line-numbers-rows.js"></script>
                <script>rowsNumbers(9);</script>
              </span>
            </div>
          </div>
        </div>
        <p>Это является особенностью стрелочных функций. Они полезны, когда мы на самом деле не хотим иметь отдельное значение <code>this</code>, а хотим брать его из внешнего контекста. Позднее в главе <a href="/arrow-functions">Повторяем стрелочные функции</a> мы увидим больше примеров на эту тему.</p>
      </div>
    </div>
  </div>
</body>

</html>